<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" href="#">
	<!-- jquery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>

	<!-- bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>

	<!-- summernote -->
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
	<title>Article Writing Page</title>
</head>
<body>
    <!-- <div id="summernote"></div> -->
    <h1>글 작성 페이지</h1>
    <div class="container">
    	<form method="post" action="/board/write.do" name="writeArticleForm" id="writeArticleForm" encType="multipart/form-data">
    		<input type="text" name="title">
    		<input type="text" name="author" value="${loginId }">
    		<select name="category" class="custom-select" id="category">
    			<option value="free">자유게시판</option>
    		</select>
    		<br><br>
    		<textarea id="summernote" name="content"></textarea>
    		<button type="button" class="btn btn-success" id="saveBtn">글 작성하기</button>
    	
    	</form>
    </div>

    <script>
	    $(function(){
			//섬머노트 실행
			$('#summernote').summernote({
				placeholder: 'Hello Bootstrap 4',
				tabsize: 2,
				height: 100,
				
				// 콜백함수
 				callbacks : {
					onImageUpload : function(files, editor, welEditable) {
						console.log("콜백함수 onImageUpload :");
						console.log("editor");
						console.log(editor);
						console.log(this);
						console.log("welEditable");
						console.log(welEditable);
						// 파일 업로드(다중 업로드를 위해 반복문 사용)
 						 for(var i = 0; i < files.length; i++) {
							sendFile(files[i], this, welEditable);
						}  
					}
				} 
			});
			
			// 글 저장
			$("#saveBtn").click(function(){
				$("#writeArticleForm").submit();
			});
	    }) // function() end
	    
	    
	    // 썸머노트 이미지 업로드 콜백함수
	    function sendFile(file, editor, welEditable) {
	    	data = new FormData();
	    	data.append("file", file);
	    	$.ajax({
	    		data: data,
	    		type: "post",
	    		url: "/board/summerNoteTest",
	    		contentType: false,
	    		processData: false,
	    		enctype: "multipart/form-data",
	    		success: function(data) {
	    			console.log("썸머노트 url 변경 성공");
	    			console.log(data);
	    			console.log(editor);
	    			var rs = data.substring(data.lastIndexOf('\\resources'));
	    			console.log("rs : " + rs);
	    			$(editor).summernote('editor.insertImage', data);
	    			//editor.insertImage(data);
	    		} ,
	    		error: function(data) {
	    			console.log("썸머노트 url 변경 실패");
	    			console.log(data);
	    		}
	    	});
	    }
      
      
    </script>
</body>
</html>