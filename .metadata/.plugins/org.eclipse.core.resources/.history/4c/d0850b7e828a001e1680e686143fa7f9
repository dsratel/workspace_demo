<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<link rel="shortcut icon" type="image/x-icon" href="data:image/x-icon;">
	<link rel="stylesheet" href="/resources/css/bootstrap/bootstrap.min.css">
	<script src="/resources/js/jquery/jquery-3.7.1.min.js"></script>
	<title>write board page</title>
</head>
<body>
	<c:choose>
		<c:when test="${pid > 0 }">
			<h1>답글 작성하기</h1>
		</c:when>
		<c:otherwise>
			<h1>게시글 작성하기</h1>
		</c:otherwise>
	</c:choose>
	<div class="container">
		<form method="post" name="writeBoardForm" action="/board/write.do" enctype="multipart/form-data">
			<input type="hidden" name="pid" value="${pid }">
			<div class="row">	<!-- 카테고리 -->
				<div class="col-2"></div>
				<div class="col-1 tab">
					<c:choose>
						<c:when test="${pid > 0}">
							<span>원본 글 제목</span>
						</c:when>
						<c:otherwise>
							<span>카테고리</span>				
						</c:otherwise>
					</c:choose>
				</div>
				<div class="col-7 cont">
					<c:choose>
						<c:when test="${category eq '' }">
							<select class="form-select" name="category" id="category">
								<option value="free">자유게시판</option>
								<option value="notice">공지사항</option>
							</select>						
						</c:when>
						<c:otherwise>
							<span>${orgTitle }</span>
						</c:otherwise>
					</c:choose>
				</div>
				<div class="col-2"></div>
			</div>
			<div class="row">	<!-- 제목 -->
				<div class="col-2"></div>
				<div class="col-1 tab">
					<span>제목</span>
				</div>
				<div class="col-7 cont">
					<input class="form-control" type="text" name="title" id="title">
				</div>
				<div class="col-2"></div>
			</div>
			<div class="row">	<!-- 작성자 -->
				<div class="col-2"></div>
				<div class="col-1 tab">
					<span>작성자</span>
				</div>
				<div class="col-7 cont">
					<input class="form-control" type="text" name= "author" id="author" value="${loginId}" readonly>
				</div>
				<div class="col-2"></div>
			</div>
			<div class="row">	<!-- 내용 -->
				<div class="col-2"></div>
				<div class="col-1 tab">
					<span>내용</span>
				</div>
				<div class="col-7 cont">
					<textarea class="form-control" id="content" name="content"></textarea>
				</div>
				<div class="col-2"></div>
			</div>
			<div class="row">	<!-- 첨부파일 -->
				<div class="col-2"></div>
				<div class="col-1 tab">
					<span>첨부파일</span>
				</div>
				<div class="col-7 cont">
					<input class="form-control" type="file" name="upfile">
					<input class="form-control" type="file" name="upfile">
					<input class="form-control" type="file" name="upfile">
					<input type="hidden" name="attachfile" id="attachfile">
					<input type="hidden" id="fileCnt">
				</div>
				<div class="col-2"></div>
			</div>
			<div class="row" id="btnDiv">
				<div class="col">
			    	<button type="button" class="btn btn-primary" id="writeBtn">글 작성하기</button>
		    		<button type="button" class="btn btn-secondary" id="listBtn">글 목록으로</button>				
				</div>
			</div>
		</form>
	</div>
	<script>
		$(function(){
			// css
			$("div.tab, div.cont").css({"border" : "1px solid black", "padding" : "5px"});
			$("button").css({"display" : "inline-block", "width" : "20%", "margin": "5px"});
			$("#btnDiv, .tab").css("text-align", "center");	
			$(".container").css("margin-top", "20px");
			$("#content").css({"width" : "100%", "height" : "300px", "border" : "none", "resize" : "none"});
			
			// 글 작성 버튼
			$("#writeBtn").click(function(){
				// 유효성 검사
				//// 제목
				if($("#title").val().length < 1) {
					alert("제목을 입력해주세요.");
					return;
				}
				
				//// 내용
				if($("#content").val().length < 1) {
					alert("내용을 입력해주세요.");
					return;
				}
				
				// 파일 개수 체크
				var fileCnt = 0;
				var files = $("input[type='file']");
				for(var i = 0; i < files.length; i++) {
					if(files.get(i).files.length > 0) {
						fileCnt++;
					} else {
						files.get(i).name = '';
					}
				}
				
				// 파일이 있는 경우 attachfile에 y값 입력
				if(fileCnt > 0) {
					$("#attachfile").val('y');
					
				} else {
					$("#attachfile").val('n');
				}
				
				// 파일 개수 입력
				$("#fileCnt").val(fileCnt);
				
				if(confirm("글 작성을 하시겠습니까?")) {
					$("form[name='writeBoardForm']").submit();					
				}
			});
			
			// 글 목록 버튼
			$("#listBtn").click(function(){
				window.location.replace("/board/toList");
			});
		})	// function() end
	</script>
</body>
</html>